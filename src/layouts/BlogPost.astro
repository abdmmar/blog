---
import type { MarkdownHeading } from "astro";
import { Image } from "astro:assets";
import type { CollectionEntry } from "astro:content";
import Balancer from "react-wrap-balancer";
import BaseHead from "../components/BaseHead.astro";
import CopyCodeButton from "../components/CopyCodeButton.astro";
import { TOC } from "../components/TOC";

type Props = {
  frontmatter: CollectionEntry<"blog">["data"];
  headings?: MarkdownHeading[];
};

const dateFormatter = new Intl.DateTimeFormat("id-ID", {
  dateStyle: "short",
});
const { frontmatter, headings } = Astro.props;
const { title, description, publishedAt, image, imageAlt, updatedAt, tag } =
  frontmatter;
const publishedDate = new Date(publishedAt);
const postDate = dateFormatter.format(publishedDate);
---

<html lang="en">
  <head>
    <BaseHead title={title} description={description} />
    <link href="/prims-nord.css" rel="stylesheet" />
  </head>

  <body>
    <div class="p-10 w-full grid grid-cols-8 text-gray-900 gap-10">
      <sidebar class="col-span-2">
        <div class="sticky top-10 h-[calc(100vh-80px)]">
          <div class="flex flex-col h-full justify-between">
            <h2 class="text-gray-900 text-xl flex gap-2 items-center">
              <span class="text-blue-600 animate-spin">âœ¤</span> Abdullah Ammar
            </h2>
            {headings ? <TOC headings={headings} /> : null}
          </div>
        </div>
      </sidebar>

      <main class="col-start-3 col-end-8">
        <article>
          <section class="grid grid-cols-4 gap-10">
            <div class="col-span-3 flex flex-col justify-between">
              <div class="flex justify-between min-h-[28px] items-center">
                <div class="flex font-ibmMono">
                  <span class="mr-9 text-green-600">{tag.toUpperCase()}</span>
                  <time
                    datetime={publishedDate.toISOString()}
                    class="text-gray-600">{postDate}</time
                  >
                </div>
                <button class="text-gray-600">
                  {"share".toUpperCase()}
                </button>
              </div>

              <div class="mt-20">
                <h1 class="text-gray-900 text-5xl leading-[52px] mb-12">
                  <Balancer client:load>
                    {title}
                  </Balancer>
                </h1>

                {
                  image && (
                    <Image
                      class="rounded-md mb-12"
                      width={image.width}
                      height={360}
                      src={image}
                      alt={imageAlt || ""}
                    />
                  )
                }
                <p class="text-gray-600 text-2xl mb-6">{description}</p>
                <article class="col-span-4">
                  <slot />
                </article>
              </div>
            </div>
          </section>
        </article>
      </main>
    </div>
    <CopyCodeButton />
  </body>
</html>
